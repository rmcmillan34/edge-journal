{% extends "base.html" %}

{% block title %}{{ report_date }} - Daily Trading Report{% endblock %}

{% block content %}
<div class="container">
    <!-- Cover Page -->
    <div class="cover-page">
        <div class="cover-title">Daily Trading Report</div>
        <div class="cover-subtitle">{{ report_date }}</div>
        <div class="cover-meta">
            <p>Generated: {{ generated_at }}</p>
        </div>
    </div>

    <!-- Daily Summary -->
    <div class="section no-break">
        <h1>Day Summary</h1>

        <!-- Performance Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Total P&L</div>
                <div class="metric-value {% if metrics.total_pnl > 0 %}positive{% elif metrics.total_pnl < 0 %}negative{% endif %}">
                    ${{ "%.2f"|format(metrics.total_pnl) }}
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Total Trades</div>
                <div class="metric-value">{{ metrics.total_trades }}</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Win Rate</div>
                <div class="metric-value">{{ "%.1f"|format(metrics.win_rate * 100) }}%</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Avg P&L/Trade</div>
                <div class="metric-value {% if metrics.avg_pnl_per_trade > 0 %}positive{% elif metrics.avg_pnl_per_trade < 0 %}negative{% endif %}">
                    ${{ "%.2f"|format(metrics.avg_pnl_per_trade) }}
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Largest Win</div>
                <div class="metric-value positive">${{ "%.2f"|format(metrics.largest_win) }}</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Largest Loss</div>
                <div class="metric-value negative">${{ "%.2f"|format(metrics.largest_loss) }}</div>
            </div>
        </div>

        <!-- Equity Curve -->
        {% if equity_chart %}
        <div class="chart-container">
            <h3>Equity Progression</h3>
            <img src="{{ equity_chart }}" alt="Equity Curve" />
        </div>
        {% endif %}
    </div>

    <!-- Trade Details -->
    {% if trades %}
    <div class="section">
        <h2>Trade Details</h2>
        <table class="trade-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Symbol</th>
                    <th>Direction</th>
                    <th>Quantity</th>
                    <th>Entry</th>
                    <th>Exit</th>
                    <th>P&L</th>
                    <th>Account</th>
                </tr>
            </thead>
            <tbody>
                {% for trade in trades %}
                <tr>
                    <td>{{ trade.open_time_utc.strftime('%H:%M') }}</td>
                    <td>{{ trade.symbol }}</td>
                    <td>{{ trade.side }}</td>
                    <td>{{ trade.qty_units if trade.qty_units else '-' }}</td>
                    <td>${{ "%.5f"|format(trade.entry_price) if trade.entry_price else '0.00' }}</td>
                    <td>${{ "%.5f"|format(trade.exit_price) if trade.exit_price else '0.00' }}</td>
                    <td class="{% if trade.net_pnl > 0 %}positive{% elif trade.net_pnl < 0 %}negative{% endif %}">
                        ${{ "%.2f"|format(trade.net_pnl) if trade.net_pnl else '0.00' }}
                    </td>
                    <td>{{ trade.account.name }}</td>
                </tr>
                {% if trade.notes_md and include_screenshots %}
                <tr>
                    <td colspan="8" class="trade-notes">
                        <strong>Notes:</strong> {{ trade.notes_md }}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="section">
        <p class="no-data">No trades for this day.</p>
    </div>
    {% endif %}

    <!-- Daily Journal -->
    {% if journal %}
    <div class="section">
        <h2>Daily Journal</h2>
        <div class="journal-content">
            {{ journal.notes_md }}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
